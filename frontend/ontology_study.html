<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="assets/js/aoi-selection.js"></script>
    <script src="assets/js/circle-packing.js"></script>
    <script src="assets/js/eyetracking.js"></script>
    <script src="assets/js/calibration.js"></script>
    <script src="assets/js/link-tree.js"></script>
    <title>Ontology Study</title>
</head>
<body class="h_main">
    <!-- Introductory Screen -->
    <div id="introPage" class="h_sub" style="display:flex">
        <div class="h_intro_info">
            <div style="min-height:100%;width:100%;background-color:rgb(240,240,240);">
                <div style="font-size:50px;padding:20px;color:rgb(25,25,25);">How to Participate</div>
                <div style="font-size:40px;padding:20px;color:rgb(25,25,25);">
                    For this study, you will partake in 15 multiple-choice questions that will test your ontology knowledge. Please take your time and read each question carefully!
                </div>
            </div>
        </div>
        <div class="h_intro_background">
            <div style="height:950px;width:100%;background-color:rgb(240,240,240);">
                <div style="font-size:50px;padding:20px;color:rgb(25,25,25);">Background Information</div>
                <div style="font-size:40px;padding:20px;color:rgb(25,25,25);">
                    This will be background information regarding the ontology models that are in the study.
                </div>
            </div>
            <button class="h_begin_button" onclick="changePage()">Continue</button>
        </div>
    </div>

    <!-- Question and Answer Page -->
    <div id="questionPage" class="h_sub" style="display:none">
        <div class="h_question">
            <div class="h_sub_question">
                <div id="questionText">Question1</div>
                <div id="answersText" style="white-space: pre-line">Answers1</div>
            </div>
            <div class="h_answer_box">
                <button id="pageButton" class="ans_button" onclick="changePage(0)">Answer A</button>
                <button id="pageButton" class="ans_button" onclick="changePage(1)">Answer B</button>
                <button id="pageButton" class="ans_button" onclick="changePage(2)">Answer C</button>
                <button id="pageButton" class="ans_button" onclick="changePage(3)">Answer D</button>
            </div>
        </div>
        <div class="h_visual">
            <div id="tree-container" style="width:100%;height:100%;background-color:rgb(240,240,240);"></div>
        </div>
        <canvas id="aoiCanvas" width="1920" height="1080" style="position: absolute; top: 0; left: 0; z-index: 10; pointer-events: none;"></canvas>
    </div>

    <div id="outroPage" class="h_sub" style="display:none">
        <div id="outroText" class="h_outro">Final</div>
    </div>

    <script>
        const questionNum = 15;
        let answers = [];
        let page_time = [];
        let page_num = 0;
        let startTime = new Date().getTime();

        const menuIntro = document.getElementById("introPage");
        const menuQuestion = document.getElementById("questionPage");
        const menuOutro = document.getElementById("outroPage");

        const data2 = {
            "name": "disjoint",
            "children": [
                {
                    "name": "Music Drama",
                    "value": 800,
                    "children": [
                        { "name": "Opera", "value": 200 },
                        { "name": "Opereta", "value": 300 },
                        { "name": "Musical", "value": 400 }
                    ]
                }
            ]
        };

        const container = document.getElementById("tree-container");
        const svg = chart(data2, { width: 851, height: 851 });

        const svg2 = document.createElement("img");
        svg2.src = "assets/images/1.png";
        svg2.style.width = "100%";
        svg2.style.height = "100%";

        const svg3 = document.createElement("img");
        svg3.src = "assets/images/treemap.png";
        svg3.style.width = "100%";
        svg3.style.height = "100%";

        document.getElementById("tree-container").appendChild(svg);

        function updateVisual() {
            if (page_num == 6) {
                document.getElementById("tree-container").removeChild(svg);
                document.getElementById("tree-container").appendChild(svg2);
            }
            if (page_num == 11) {
                document.getElementById("tree-container").removeChild(svg2);
                document.getElementById("tree-container").appendChild(svg3);
            }
        }

        function changePage(ans = -1) {
            if (ans !== -1) answers.push(ans);
            page_num = page_num < questionNum ? page_num + 1 : questionNum + 1;

            if (page_num > questionNum) {
                const final_score = checkAnswers(answers);
                menuQuestion.style.display = "none";
                menuOutro.style.display = "flex";
                document.getElementById("outroText").textContent =
                    `Thank you for participating!\n\nFinal score: ${final_score}/${questionNum}`;
            } else if (page_num > 0) {
                menuIntro.style.display = "none";
                menuQuestion.style.display = "flex";
                document.getElementById("questionText").innerText = pageQuestions[page_num];
                document.getElementById("answersText").innerText = pageAnswers[page_num];
            }

            const endTime = new Date().getTime();
            page_time.push((endTime - startTime) / 1000.0);
            startTime = endTime;

            updateVisual();
        }

        function checkAnswers(ans_list) {
            return ans_list.filter((ans, i) => ans === pageSolutions[i]).length;
        }
    </script>
</body>
</html>
