<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="link-tree.js"></script>
    <script src="circle-packing.js"></script>
    <script src="aoi-selection.js"></script>
</head>

<!--Main body of the webpage-->
<body class="h_main">
    <!--Display for the introductory screen-->
    <div id="introPage" class="h_sub" style="display:flex">
        <!--Display for information regarding the study, and how participants should approach it-->
        <div class="h_intro_info">
            <div style="min-height:95%;width:90%;background-color:rgb(240,240,240);margin-top:20px;border:none;border-radius:10px;">
                <div style="font-size:30px;padding:20px;color:rgb(25,25,25);">How to Participate</div>
                <div style="font-size:20px;padding:20px;color:rgb(25,25,25);">For this study, you will partake in 15 multiple-choice questions that will test your ontology knowledge. Please take your time and read each question carefully!</div>
            </div>
        </div>
        <!--Dispaly for information regarding the ontology models used, and information that could make answering them easier and more intuitive-->
        <div class="h_intro_background">
            <div style="min-height:87%;width:90%;background-color:rgb(240,240,240);margin-top:20px;border:none;border-radius:10px;">
                <div style="font-size:30px;padding:20px;color:rgb(25,25,25);">Background Information</div>
                <div style="font-size:20px;padding:20px;color:rgb(25,25,25);">This will be background information regarding the ontology models that are in the study</div>
            </div>
            <button class="h_begin_button" onclick="changePage()">Continue</button>
        </div>
    </div>

    <!--Display for questions and answers, used for questionaire participation-->
    <div id="questionPage" class="h_sub" style="display:none">
        <script>
            let pageState = 0;
        </script>

        <!--Div for questions and answers-->
        <div class="h_question">
            <!--Div for question and answer-option text-->
            <div class = "h_sub_question">
                <div id="questionText">
                    Question1
                </div>
                <div id="answersText" style="white-space: pre-line">
                    Answers1
                </div>
            </div>

            <!--Container for the answer buttons-->
            <div class="h_answer_box">
                <button id="pageButton" class="ans_button" onclick="changePage(0)">Answer A</button>
                <button id="pageButton" class="ans_button" onclick="changePage(1)">Answer B</button>
                <button id="pageButton" class="ans_button" onclick="changePage(2)">Answer C</button>
                <button id="pageButton" class="ans_button" onclick="changePage(3)">Answer D</button>
            </div>

            <!--Script containing the questions and answers for the question page-->
            <script>
                const questionNum = 15;

                //List of all questions
                const pageQuestions = 
                {
                    1: "Question 1:\n\nGiven the current model, can an entity be both an #Opera and an #Operetta?",
                    2: "Question 2:\n\nGiven the current model, can an entity be both an #Operetta and a #MusicDrama?",
                    3: "Question 3:\n\nHow many objects will be left in the #Opera intersection?",
                    4: "Question 4:\n\nHow many subclasses does the class #MusicDrama contain?",
                    5: "Question 5:\n\nHow many total connections do you see in this model?",
                    6: "Question 6:\n\nIs there a relationship between #USSoccerTeam and #TennisTeam?",
                    7: "Question 7:\n\nWhich class in the model is #FootballTeam mapped to? ",
                    8: "Question 8:\n\nHow many total connections do you see in this model?",
                    9: "Question 9:\n\nWould it be logical to put a sameAs relationship between #FootballTeam and a class #SwimmingTeam?",
                    10: "Question 10:\n\nHow many mappings are there from the #Sports class?",
                    11: "Question 11:\n\nYou have an entity “Sandwich” that is not a vegetarian option. Which class would it then be mapped to?",
                    12: "Question 12:\n\nWould the model still function if a third class #VeganOptions was added?",
                    13: "Question 13:\n\nHow many total connections do you see in this model?",
                    14: "Question 14:\n\nAre all members of #VegetarianOptions and #StandardOptions members of the #RestaurantItems class?",
                    15: "Question 15:\n\nHow many connections does the #VegetarianOptions class have?",
                };

                //List of all answers
                const pageAnswers = 
                {
                    1: "A) Yes, they will always be both\nB) No, they can never be both\nC) Yes, but only if specified\nD) No, an entity cannot be either",
                    2: "A) Yes, they will always be both\nB) No, they can never be both\nC) Yes, but only if specified\nD) No, an entity cannot be either",
                    3: "A) 1\nB) 2\nC) 3\nD) 4",
                    4: "A) 2\nB) 3\nC) 4\nD) 5",
                    5: "A) 1\nB) 3\nC) 5\nD) 7",
                    6: "A) Yes, they are disjoint\nB) No, they are completely separate\nC) Yes, they are contained in the same class\nD) Yes, they are equivalent classes",
                    7: "A) #TennisTeam\nB) #USSoccerTeam\nC) #BowlingTeam\nD) No classes",
                    8: "A) 1\nB) 2\nC) 3\nD) 4",
                    9: "A) Yes, they are both #Sports\nB) Yes, they are both US teams\nC) No, two classes cannot be SameAs\nD) No, they are differnt sports",
                    10: "A) 1\nB) 2\nC) 3\nD) 4",
                    11: "A) #VegetarianOptions\nB) #StandardOptions\nC) #VeganOptions\nD) No classes",
                    12: "A) Yes, there can be infinite complementary classes\nB) Yes, 3 classes are required for complementOf\nC) No, complementOf only works with 2 classes\nD) No, Vegan and Vegetarian are the same",
                    13: "A) 1\nB) 2\nC) 3\nD) 4",
                    14: "A) Yes, they are required to be\nB) Yes, but only if specified\nC) No, they are members of #MenuItems\nD) No, they are not members of any class",
                    15: "A) 3\nB) 2\nC) 1\nD) 0"
                };

                //List of all correct answers (by index)
                const pageSolutions = [1, 0, 3, 2, 1, 2, 1, 0, 3, 2, 1, 2, 1, 0, 2];
            </script>
        </div>
        
        <!--Div for visualization, implementing D3 later on-->
        <div class="h_visual">
            <div id="tree-container" style="width:95%;height:95%;background-color:rgb(240,240,240);border:none;border-radius:10px;"></div>
        </div>

        <canvas id="aoiCanvas" width="800" height="600" style="position: absolute; top: 0; left: 0; z-index: 10; pointer-events: none;"></canvas>
        <button onclick="enableAOISelection()" style="position: relative; z-index: 11;">Start AOI Selection</button>

    </div>

    <!--Display for the final thank you and results page-->
    <div id="outroPage" class="h_sub" style="Display:none">
        <div id="outroText" class="h_outro">
            Final
        </div>
    </div>

    <!--Script containing the logic for tracking, iterating and updating page information-->
    <script>
        //Variable that will keep track of user answers to questions
        let answers = []
        //Variable t hat will keep track of the amount of time a user spends on each page
        let page_time = []
        //Page number variable, used to track the current page state
        let page_num = 0;

        //Establish constant variables for the intro, question and outro pages
        const menuIntro = document.getElementById("introPage");
        const menuQuestion = document.getElementById("questionPage")
        const menuOutro = document.getElementById("outroPage");
        const continueButton = document.getElementById("pageButton");

        //Establish a starting variable for keeping track of time when navigating the page. This should begin as soon as the web page is accessed
        let startTime = new Date().getTime();

        //Function for iterationg through pages
        function changePage(ans=-1)
        {
            //Push the selected answer to the final list of answers
            if (ans != -1)
            {
                answers.push(ans);
            }

            //Iterate the page number with a limit of 13
            page_num = page_num < questionNum ? page_num + 1: (questionNum + 1);

            console.log("page_num: " + page_num);
            //If the page number is over 12, remove the question page and and instead display the outro page
            if (page_num > questionNum)
            {
                final_score = checkAnswers(answers);

                menuQuestion.style.display = "none";
                menuOutro.style.display = "flex";
                continueButton.style.display="none";

                document.getElementById("outroText").textContent = ("Thank you for participating!\n\nFinal score: " + final_score + "/" + questionNum)
                console.log(page_time)
            }
            //If the page number is between 1 and 12, display the appropriate questions page
            else if (page_num > 0)
            {
                menuIntro.style.display = "none";
                menuQuestion.style.display = "flex";

                //Update the text for questions and answers
                document.getElementById("questionText").innerText = pageQuestions[page_num];
                document.getElementById("answersText").innerText = pageAnswers[page_num];
            }

            //Regardless of what happens, update the time variable to keep track of user duration
            const endTime = new Date().getTime();
            const timeSpent = (endTime - startTime) / 1000.0
            //Push the time spent on the page to the final duration tracker, and reset the current time tracker
            page_time.push(timeSpent);
            startTime = endTime;

            updateVisual();
            
        }

        function checkAnswers(ans_list)
        {
            let correct_ans = 0
            for (i = 0; i < questionNum; i++)
            {
                if (ans_list[i] === pageSolutions[i])
                {
                    correct_ans++;
                }
            }
            return correct_ans;
        }

        // Define the data for the tree

        const data = {
                "name": "disjoint",
                "children": [
                    {
                    "name": "Music Drama", "value": 800,
                    "children": [
                    {
                        "name": "Opera", "value": 200
                    },
                    {
                        "name": "Opereta", "value": 300
                    },
                    {
                        "name": "Musical", "value": 400
                    }
                    ]
                    }
                ]
            };

            const data2 = {
                "name": "United States",
                "children": [
                    {
                        "name": "California",
                        "children": [
                            {"name": "San Bernardino"},
                            {"name": "Los Angeles"}
                        ]
                    },
                    {
                        "name": "Texas",
                        "children": [
                            {"name": "Dallas"}
                        ]
                    }
	            ]
            }

            const container = document.getElementById("tree-container");
            const containerWidth = 851;
            const containerHeight = 851;
    
            // Set up tree options if desired
            const options = {
                width: containerWidth,
                height: containerHeight,
                label: d => d.name, // Display the name property
                fill: "#66c2a5",
                stroke: "#1b9e77"
            };
        
            // Create the tree visualization
            const svg = Tree(data2, options);
            const svg2 = chart(data, options);
        
            // Append the SVG to the div container
            document.getElementById("tree-container").appendChild(svg);

            function updateVisual()
            {
                if(page_num == 6)
                {
                    document.getElementById("tree-container").removeChild(svg);
                    document.getElementById("tree-container").appendChild(svg2);
                }
            }
    </script>
</body>